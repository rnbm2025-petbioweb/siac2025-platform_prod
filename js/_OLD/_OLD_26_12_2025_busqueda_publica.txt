console.log("ğŸ”¥ busqueda_publica.js CARGADO DESDE SIAC2025", new Date().toISOString());

document.addEventListener('DOMContentLoaded', () => {

  const btnEncontre = document.getElementById('btn-encontre');
  const contenedor = document.getElementById('busqueda-mascota');
  const btnBuscar  = document.getElementById('btn-buscar');
  const input      = document.getElementById('codigo-mascota');
  const resultado  = document.getElementById('resultado-busqueda');

  // Mostrar buscador
  btnEncontre.addEventListener('click', () => {
    contenedor.classList.toggle('hidden');
  });

  // Buscar mascota
  btnBuscar.addEventListener('click', async () => {

    const codigo = input.value.trim();

    if (!/^\d{6}$/.test(codigo)) {
      resultado.innerHTML =
        `<p class="text-red-600">âš ï¸ Ingresa exactamente 6 dÃ­gitos.</p>`;
      return;
    }

    resultado.innerHTML = 'ğŸ” Buscando...';

    console.log("ğŸ“¡ Enviando POST a:", "https://publicpetbio.siac2025.com/buscar_mascota_publica.php");


    try {
      const res = await fetch('https://publicpetbio.siac2025.com/buscar_mascota_publica.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: `codigo=${encodeURIComponent(codigo)}`
      });

      const data = await res.json();

      if (!data.encontrada) {
        resultado.innerHTML =
          `<p class="text-gray-600">âŒ No se encontrÃ³ ninguna mascota.</p>`;
        return;
      }

      if (data.extraviada) {
        resultado.innerHTML = `
          <div class="p-4 border rounded bg-red-50">
            <p class="font-bold text-red-700">
              ğŸš¨ Mascota reportada como extraviada
            </p>
            <p><strong>Nombre:</strong> ${data.nombre}</p>
            <p><strong>Raza:</strong> ${data.raza}</p>
            <p><strong>Ciudad:</strong> ${data.ciudad}</p>

          /*  <a href="/contactar_extravio.php?id=${data.id_mascota}"*/

/*            <a href="/contactar_extravio.php?id_extravio=${data.id_extravio}">*/

/*            <a href="/contactar_extravio.php?id_mascota=${data.id_mascota}">*/

              <a
                href="/contactar_extravio.php?id_mascota=${data.id_mascota}"
                class="inline-block mt-3 bg-red-600 text-white px-4 py-2 rounded"
              >
                ğŸ“© Contactar tutor
              </a>

          </div>
        `;
      } else {
        resultado.innerHTML = `
          <div class="p-4 border rounded bg-green-50">
            <p class="font-bold text-green-700">
              âœ… Mascota registrada (sin reporte de extravÃ­o)
            </p>
            <p><strong>Nombre:</strong> ${data.nombre}</p>
            <p><strong>Raza:</strong> ${data.raza}</p>
            <p><strong>Ciudad:</strong> ${data.ciudad}</p>
          </div>
        `;
      }

    } catch (e) {
      resultado.innerHTML =
        `<p class="text-red-600">âŒ Error al consultar.</p>`;
    }

  });

});
